<div id="location-modal" class="popup popup--tablet-le-bottom">
    <div class="popup__wrapper">
        <button class="js-popup-close popup__close"></button>
        <div class="custom-scrollbar popup__inner popup__inner--with-p">
            <div class="popup-form popup__form">
                <div class="popup-form__head">
                    <h2 class="popup-form__title">Edit Location</h2>
                </div>
                <form id="editLocationForm">
                    {% csrf_token %}
                    <input type="hidden" name="edit_type" value="location">

                    <div class="popup-form__body">
                        <div class="popup-form__item">
                            <label class="popup-form__label">Address</label>
                            <input type="text" class="input popup-form__input" placeholder="1620 14th Ave S"
                                name="Address" value="{{address}}">
                        </div>
                        <div class="popup-form__item">
                            <label class="popup-form__label">City</label>
                            <input type="text" class="input popup-form__input" placeholder="Birgmingham" name="City"
                                value="{{city}}">
                        </div>
                        <div class="popup-form__item">
                            <label class="popup-form__label">State</label>
                            <select class="input input--select" name="State">
                                <option value="AL" {% if state|upper == "AL" %} selected {% endif %}>Alabama</option>
                                <option value="AK" {% if state|upper == "AK" %} selected {% endif %}>Alaska</option>
                                <option value="AZ" {% if state|upper == "AZ" %} selected {% endif %}>Arizona</option>
                                <option value="AR" {% if state|upper == "AR" %} selected {% endif %}>Arkansas</option>
                                <option value="CA" {% if state|upper == "CA" %} selected {% endif %}>California</option>
                                <option value="CO" {% if state|upper == "CO" %} selected {% endif %}>Colorado</option>
                                <option value="CT" {% if state|upper == "CT" %} selected {% endif %}>Connecticut
                                </option>
                                <option value="DE" {% if state|upper == "DE" %} selected {% endif %}>Delaware</option>
                                <option value="DC" {% if state|upper == "DC" %} selected {% endif %}>District Of
                                    Columbia
                                </option>
                                <option value="FL" {% if state|upper == "FL" %} selected {% endif %}>Florida</option>
                                <option value="GA" {% if state|upper == "GA" %} selected {% endif %}>Georgia</option>
                                <option value="HI" {% if state|upper == "HI" %} selected {% endif %}>Hawaii</option>
                                <option value="ID" {% if state|upper == "ID" %} selected {% endif %}>Idaho</option>
                                <option value="IL" {% if state|upper == "IL" %} selected {% endif %}>Illinois</option>
                                <option value="IN" {% if state|upper == "IN" %} selected {% endif %}>Indiana</option>
                                <option value="IA" {% if state|upper == "IA" %} selected {% endif %}>Iowa</option>
                                <option value="KS" {% if state|upper == "KS" %} selected {% endif %}>Kansas</option>
                                <option value="KY" {% if state|upper == "KY" %} selected {% endif %}>Kentucky</option>
                                <option value="LA" {% if state|upper == "LA" %} selected {% endif %}>Louisiana</option>
                                <option value="ME" {% if state|upper == "ME" %} selected {% endif %}>Maine</option>
                                <option value="MD" {% if state|upper == "MD" %} selected {% endif %}>Maryland</option>
                                <option value="MA" {% if state|upper == "MA" %} selected {% endif %}>Massachusetts
                                </option>
                                <option value="MI" {% if state|upper == "MI" %} selected {% endif %}>Michigan</option>
                                <option value="MN" {% if state|upper == "MN" %} selected {% endif %}>Minnesota</option>
                                <option value="MS" {% if state|upper == "MS" %} selected {% endif %}>Mississippi
                                </option>
                                <option value="MO" {% if state|upper == "MO" %} selected {% endif %}>Missouri</option>
                                <option value="MT" {% if state|upper == "MT" %} selected {% endif %}>Montana</option>
                                <option value="NE" {% if state|upper == "NE" %} selected {% endif %}>Nebraska</option>
                                <option value="NV" {% if state|upper == "NV" %} selected {% endif %}>Nevada</option>
                                <option value="NH" {% if state|upper == "NH" %} selected {% endif %}>New Hampshire
                                </option>
                                <option value="NJ" {% if state|upper == "NJ" %} selected {% endif %}>New Jersey</option>
                                <option value="NM" {% if state|upper == "NM" %} selected {% endif %}>New Mexico</option>
                                <option value="NY" {% if state|upper == "NY" %} selected {% endif %}>New York</option>
                                <option value="NC" {% if state|upper == "NC" %} selected {% endif %}>North Carolina
                                </option>
                                <option value="ND" {% if state|upper == "ND" %} selected {% endif %}>North Dakota
                                </option>
                                <option value="OH" {% if state|upper == "OH" %} selected {% endif %}>Ohio</option>
                                <option value="OK" {% if state|upper == "OK" %} selected {% endif %}>Oklahoma</option>
                                <option value="OR" {% if state|upper == "OR" %} selected {% endif %}>Oregon</option>
                                <option value="PA" {% if state|upper == "PA" %} selected {% endif %}>Pennsylvania
                                </option>
                                <option value="RI" {% if state|upper == "RI" %} selected {% endif %}>Rhode Island
                                </option>
                                <option value="SC" {% if state|upper == "SC" %} selected {% endif %}>South Carolina
                                </option>
                                <option value="SD" {% if state|upper == "SD" %} selected {% endif %}>South Dakota
                                </option>
                                <option value="TN" {% if state|upper == "TN" %} selected {% endif %}>Tennessee</option>
                                <option value="TX" {% if state|upper == "TX" %} selected {% endif %}>Texas</option>
                                <option value="UT" {% if state|upper == "UT" %} selected {% endif %}>Utah</option>
                                <option value="VT" {% if state|upper == "VT" %} selected {% endif %}>Vermont</option>
                                <option value="VA" {% if state|upper == "VA" %} selected {% endif %}>Virginia</option>
                                <option value="WA" {% if state|upper == "WA" %} selected {% endif %}>Washington</option>
                                <option value="WV" {% if state|upper == "WV" %} selected {% endif %}>West Virginia
                                </option>
                                <option value="WI" {% if state|upper == "WI" %} selected {% endif %}>Wisconsin</option>
                                <option value="WY" {% if state|upper == "WY" %} selected {% endif %}>Wyoming</option>
                            </select>
                        </div>
                        <div class="popup-form__item">
                            <label class="popup-form__label">Zip code</label>
                            <input type="text" class="input popup-form__input" placeholder="35205" value="{{zip}}"
                                name="Postal">
                        </div>
                        <div class="popup-form__item">
                            <label class="popup-form__label">Country/Region</label>
                            <input type="text" class="input popup-form__input" placeholder="United States"
                                name="Country" value="{{country}}">
                        </div>
                    </div>
                    <div class="popup-form__controls">
                        <button class="button popup-form__controls-item">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<script>
    var url = "{% url 'backend_django_v2:edit_company' id=company.id %}"
    $(document).ready(function () {

        var successModal = document.querySelector("#editSuccessModal");
        var modals = document.querySelectorAll('.popup');

        function closeAllModals() {
            modals.forEach(modal => {
                modal.classList.remove('popup--active');
            });
        }

        function openSuccessModal() {
            successModal.classList.add('popup--active');
        }


        var data = {
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            edit_type: 'location',
        };
        var originalData = {
            Country: "{{country}}",
            State: "{{state}}",
            City: "{{city}}",
            Address: "{{address}}",
            Postal: "{{zip}}"
        };


        $('#editLocationForm input, #editLocationForm select').change(function () {
            var key = $(this).attr('name');
            if (originalData[key] === $(this).val() || $(this).val() === '') {
                delete data[key];
            } else {
                data[key] = $(this).val();
            }
        });


        $('#editLocationForm').on('submit', function (e) {
            e.preventDefault();

            if (Object.keys(data).length <= 2) {
                alert('Please make modifications before submit');
                return;
            }
            $.ajax({
                url: url,
                method: 'POST',
                data: data,
                success: function (response) {
                    if (response.status === 'success') {
                        closeAllModals();
                        openSuccessModal();
                    } else {
                        alert(response.message);
                    }
                }
            });
        });
    });
</script>