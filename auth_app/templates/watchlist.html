{% extends 'expandable/base.html' %}
{% load static %}
{% block title %} My Prospects | Kona Equity {% endblock %}
{% block head %}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><!-- CSS only -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<link rel="icon" href="{% static 'profile_photos/favicon.ico' %}" type="image/gif" sizes="32x32">
<link rel="apple-touch-icon" href="{% static 'profile_photos/logo.png' %}">
<link rel="stylesheet" href="{% static 'css/find.css' %}">
<link rel="stylesheet" href="{% static 'css/about.css' %}">
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<link rel="stylesheet" href="{% static 'css/watchlist.css' %}">
<link rel="stylesheet" href="{% static 'css/menusearch.css' %}">
<link rel="stylesheet" href="{% static 'css/loading.css' %}">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163184927-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
    window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
    function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
    gtag('js', new Date());
  gtag('config', 'G-GXS2W1JXVR');
    gtag('config', 'UA-163184927-1');
  </script>

<script>
  (function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "56y5lp4wnt");
</script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="{% static 'js/lazysizes.min.js' %}" async></script>
<style>
  .container-fluid.row.menu-top{background-color:#FFF;padding-top:12px; padding-bottom:12px;max-width: 1260px;width:100%; margin: 0 auto;}
  #menu-bar a, .headlinks{color: #383838; font-family:"Circular Air", sans-serif;font-size:14px;}
  .headlinks{padding-left:20px;}
  body{background-color:#fff;color:#383838;}
  .biggy{padding-left:0px!important;}
  .upb{padding-left:0px;}
  .container-fluid.row{padding-left:20px;}
  @media only screen and (min-width: 1600px){
    .boxii {
      max-width: 25%;
    }}
    .p-0 {font-size: 16px;font-weight: 400;}
    .set-background {
      background-color: #007a87;
    }
    .rounded-style-3 {
      border-radius: 0px;
    }
    .boxii{padding-top:0%;padding-bottom:4%;}
    #menu-bar{margin-left: 14%;width: 45%;}
    .ex-spacing{width:10%;}
    .la-ball-scale-pulse{color:#00D1C1;}
  </style>
  <script src="https://www.googleoptimize.com/optimize.js?id=OPT-P69KL7V"></script>


  <form id="logout" method="post" action="{% url 'account_logout' %}">
    {% csrf_token %}
    {% if redirect_field_value %}
    <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
    {% endif %}
  </form>
  <style>
    .unlock-btn{
      background: #00d1c2;
      border: 1px solid #00d1c2;
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      padding: 4px 11px;
      border-radius: 5px;
      cursor: pointer;
    }
    .unlock-btn:hover{
      background: #03a89d;
      border: 1px solid #03a89d;
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      padding: 4px 11px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
  {% endblock head %}
  {% block content %}
  <div>
    <header class="header">
      <div class="header__wrapper">
        <div class="container">
          <div class="header__inner">
            <div class="header__main">
              <a href="/" class="header__logo">
                <picture class="logo">
                  {% if request.user.profile.paid %}
                  <style>
                    .header__main{grid-template-columns: 100px 1fr!important;}
                    @media (max-width: 767px){
                      .header__inner {grid-gap: 75px;}
                    }</style>
                    <img src="{% static 'web_photos/logopremium.svg' %}" alt="Kona Equity logo"
                    class="logo__img" onclick="window.location.href='/';" />
                    {% else %}
                    <img src="{% static 'backend_django_v2/images/main/logo-color.svg' %}" alt="Kona Equity logo"
                    class="logo__img" onclick="window.location.href='/';" />
                    {% endif %}
                  </picture>
                </a>
                <nav class="header__nav header__main-nav">
                  <ul class="header__nav-list">
                    <li class="header__nav-item">
                      <a href="/about/" class="header__nav-link">About</a>
                    </li>

                    <li class="header__nav-item">
                      <a href="/find/" class="header__nav-link">Explore</a>
                    </li>
                    <li class="header__nav-item">
                      <a href="/premium/" class="header__nav-link">Premium</a>
                    </li>
                    <li class="header__nav-item">
                      <a href="/contact/" class="header__nav-link">Contact us</a>
                    </li>
                  </ul>
                </nav>
              </div>


              <div class="header__secondary">
                <form style="position: relative;" id="id_input" action="/find/--/" method="GET"
                class="search-form header__search header__main-search">

                <input id="searchText" class="input header__search-input search__input" placeholder="Find companies" type="text" />
                <button class="header__search-button" type="submit"></button>
                <div id="searchResult" class="searchDropDown search__result">

                </div>
              </form>

              {% if request.user.is_authenticated %}
              <div class="header__controls header__main-controls">
                <div class="header__controls-item">
                  <a href="{% url 'dashboard' %}" class="button-inline">Profile</a>
                </div>
                <div class="header__controls-item">
                  <a href="{% url 'watchlist' %}" class="button-inline">Prospects</a>
                </div>
                <div class="header__controls-item">
                  <a href="javascript:void(0)" class="button-inline logmeout">Logout</a>
                </div>

              </div>
              {% else %}
              <div class="header__controls header__main-controls">
                <div class="header__controls-item">
                  <a href="/login" class="button-inline">Sign in</a>
                </div>
                <div class="header__controls-item">
                  <a href="/signup/cold-join" class="button button--primary header__controls-button">Sign up</a>
                </div>
              </div>
              {% endif %}


              <button class="menu-button header__menu-button" id="hamburgerMenu">
                <span></span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="header-drop-menu">
        <nav class="header__nav">
          <ul class="header__nav-list">
            <li class="header__nav-item">
              <a href="/about/" class="header__nav-link">About</a>
            </li>
            <li class="header__nav-item">
              <a href="/find/" class="header__nav-link">Explore</a>
            </li>
            <li class="header__nav-item">
              <a href="/premium/" class="header__nav-link">Premium</a>
            </li>
            <li class="header__nav-item">
              <a href="/contact/" class="header__nav-link">Contact us</a>
            </li>
          </ul>
        </nav>

        <form class="header__search">
          <input class="input header__search-input search__input" placeholder="2.3M companies worldwide" type="text" id="searchBoxPhone" />
          <button class="header__search-button" type="submit"></button>
          <div id="searchResultPhone" class="searchDropDown search__result">

          </div>
        </form>

        {% if not request.user.is_authenticated %}
        <div class="header__controls">
          <div class="header__controls-item">
            <p class="label">Have an account?</p>
            <a href="/login" class="button-inline button-inline--primary">Sign in</a>
          </div>
          <div class="header__controls-item">
            <a href="/signup/cold-join" class="button button--primary header__controls-button">Sign up</a>
          </div>
        </div>
        {% else %}
        <div class="header__controls">
          <div class="header__controls-item">
            <a href="{% url 'dashboard' %}" class="button-inline">Profile</a>
          </div>
          <div class="header__controls-item">
            <a href="{% url 'watchlist' %}" class="button-inline">Prospects</a>
          </div>
          <div class="header__controls-item">
            <a href="javascript:void(0)" class="button-inline logmeout">Logout</a>
          </div>
        </div>
        {% endif %}


      </div>
    </header>


    <div class="company-content">
      <div class="container">

          <div style="width:100%;margin:0 auto;padding-top:64px;">
            <div class="container-fluid row" style=" background-color: #FFF; margin: auto;">
              <h1 class="upb" style="padding-left:0px; color: #383838;text-transform:capitalize;">
                Welcome {{name}}
              </h1>
            </div>
            <div class="container-fluid">
              <div class="row justify-content-center" style="background-color:#FFF; padding-top:3.5%; padding-bottom: 2.5%;">
                <div class="col-12 col-lg-12 biggy" style="padding:0 3%">
                  <div class="row mx-auto">
                    <div class="col-12 col-md-3 col-lg-2" id="menu-select">
                      <div class="row p-2 tabs" id="saved" style="color: white">
                        <div class="col p-0">Prospects</div>
                      </div>
                      <div id="study" class="row p-2 tabs">
                        <div class="col p-0">
                          Suggestions
                        </div>
                      </div>
                      <div id="visited" class="row p-2 tabs">
                        <div class="col p-0">
                          Companies Viewed
                        </div>
                      </div>
                    </div>

                    <div id="intro" class="glide">
                      <div class="glide__track" data-glide-el="track">
                        <ul class="glide__slides">
                          <li class="glide__slide">
                            <div id="saved" class="row p-2 tabsy car-options" style="color: white">
                              <div class="col p-0">
                                Prospects
                              </div>
                            </div>

                          </li>
                            <li class="glide__slide">
                              <div id="study" class="row p-2 tabsy car-options">
                                <div class="col p-0">
                                  Suggestions
                                </div>
                              </div>
                            </li>
                              <li class="glide__slide">
                                <div id="visited" class="row p-2 tabsy car-options">
                                  <div class="col p-0">
                                    Companies Viewed
                                  </div>
                                </div>
                              </li>
                            </ul>
                          </div>
                        </div>

                        <div class="col-11 col-md-9 col-lg-10 border-radius mx-auto rounded-style-1" id="bigbox" style="background-color: #fff;">
                          <div class="row justify-content-center">
                            <div class="col-12 nbpp" style="padding-top: 0px;">
                              <!-- Repeating Content-->
                              <div id="append" class="row">
                              </div>
                            </div>
                            <!-- END -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row" style="margin: auto;">
                <div class="col-12 col-md-3 col-lg-2">
                  <div style="width: 100%; height: 20px;"></div>
                </div>
                <div class="col-12 col-md-9 col-lg-10" id="pagination">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer class="footer container-fluid">
        <div class="container">
          <div class="footer__inner">
            <div class="footer__main">
              <div class="footer__info">
                <a href="/" class="footer__info-main">
                  <picture class="logo">
                    <img src="{% static 'backend_django_v2/images/main/logo-light.svg' %}" alt="Kona Equity logo"
                    class="logo__img" />
                  </picture>
                </a>
                <div class="footer__info-secondary">
                  <h2 class="footer__info-title">Kona Equity</h2>
                  <p class="footer__info-copyright">2022</p>
                  <a href="/privacy/" class="footer__link footer__info-link">Privacy Policy</a>
                </div>
              </div>

              <nav class="footer__primary-nav">
                <ul class="footer__primary-nav-list">
                  <li class="footer__primary-nav-item">
                    <a href="/about/" class="footer__link footer__primary-nav-link">About</a>
                  </li>
                  <li class="footer__primary-nav-item">
                    <a href="/premium/" class="footer__link footer__primary-nav-link">Premium</a>
                  </li>
                  <li class="footer__primary-nav-item">
                    <a href="/contact/" class="footer__link footer__primary-nav-link">Contact us</a>
                  </li>
                  <li class="
                  footer__primary-nav-item footer__primary-nav-item--only-phone
                  ">
                  <a href="/privacy/" class="footer__link footer__primary-nav-link">Privacy Policy</a>
                </li>
              </ul>
            </nav>
          </div>

          <div class="footer__secondary">
            <h3 class="footer__secondary-title">Explore popular industries</h3>

            <nav class="footer__nav">
              <ul class="footer__nav-list">
                {% for a in dc %}
                <li class="footer__nav-item">
                  <a href="{{a.link}}" class="footer__link footer__nav-link">{{a.name}}</a>
                </li>
                {% endfor %}

              </ul>
            </nav>
          </div>

          <p class="footer__copyright">2022</p>
        </div>
      </div>
    </footer>
    <script type="text/javascript">
      var giftofspeed = document.createElement('link');
      giftofspeed.rel = 'stylesheet';
      giftofspeed.href = "https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/css/glide.core.min.css";
      giftofspeed.type = 'text/css';
      var godefer = document.getElementsByTagName('link')[0];
      godefer.parentNode.insertBefore(giftofspeed, godefer);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@glidejs/glide" async></script>
    <script src="{% static 'js/watchlist.js' %}"></script>
    <script src="{% static 'js/utils.js' %}"></script>
    <script src="{% static 'js/autocomplete.js' %}"></script>
    <script>
      $(window).on("load",function(){

        $("#saved").addClass("rounded-style-3 set-background");
        $("#bigbox").addClass("rounded-style-2");

        logmeout();
        dropys();
        // var inp = document.getElementById("id_input")
        // autocomplete(inp);
        // Url = "{% url 'ajax_autocomplete' %}"

        var searchTimer = null;
  var searchInputs = document.querySelectorAll(".search__input");

  searchInputs.forEach((searchInput) => {
    searchInput.addEventListener("input", function(e) {
      clearTimeout(searchTimer);
      console.log(e);
      searchTimer = setTimeout(function() {
        search(searchInput.value, searchInput);
      }, 350);
    });
  });

  var searchUrl = "{% url 'ajax_autocomplete' %}";
  {% comment %} var searchResultContainer = document.querySelector("#searchResult"); {% endcomment %}

  function removeAllChildNodes(parent) {
    while (parent.firstChild) {
      parent.removeChild(parent.firstChild);
    }
  }

  var searchResult = [];

  $(".search__input").focusin(function () {
    if (!searchResult || searchResult.length === 0) {
      return;
    }
    $(".search__result").show();
  });

  $(".search__input").focusout(function () {
    setTimeout(function () {
      $(".search__result").hide();
    }, 500);
  });


  function search(query, searchInput) {
    var a, b;

    searchResultContainer = searchInput.parentElement.querySelector(".search__result");

    if (!query) {
      removeAllChildNodes(searchResultContainer);
      searchResult = [];
      $(".search__result").hide();
      return;
    }

    $.ajax({
      url: searchUrl,
      data: {
        'search': query
      },
      dataType: 'json',
      success: function (data) {
        arr = data.list;
        removeAllChildNodes(searchResultContainer);
        if (arr.length === 0) {
          a = document.createElement("div");
          a.className = "searchResultItem";
          a.innerHTML =
            `<img src="/static/profile_photos/generic.png" <span class="noSearchResult">No Results</span>`;
          searchResultContainer.appendChild(a);
          searchResult = [a];
          $("#searchText").trigger("focusin");
        }
        // a = document.createElement("DIV");
        // a.setAttribute("class", "searchResultItem");
        // a.innerHTML = ` <a
        //           href="/find/--/?name=${arr[i]}"><img src="/static/web_photos/category.svg" onerror="this.src='/static/web_photos/category.svg'"/><span>Company names containing insurance</span></a>`;
        // searchResultContainer.appendChild(a);

        // a = document.createElement("DIV");
        // a.setAttribute("class", "searchResultItem");
        // a.innerHTML = ` <a
        //           href="/find/--/?desc=${arr[i]}"><img src="/static/web_photos/gps.svg" onerror="this.src='/static/web_photos/gps.svg'"/><span>Pages containing insurance</span></a>`;
        // searchResultContainer.appendChild(a);

        for (i = 0; i < arr.length; i++) {
        //   var firstIndex = arr[i].name.toLowerCase().indexOf(query);
        //   var textLength = query.length;
          var highlightedText = '<div><img src="https://logo.clearbit.com/'+arr[i].domain+'" onerror="this.src=\'/static/profile_photos/generic.png\'" alt="' + arr[i].name + '" style="display:inline-block;padding-right:5px" />' + arr[i].name;
          a = document.createElement("DIV");
          a.setAttribute("class", "searchResultItem");
        //   a.setAttribute("href", '/company/' + arr[i].identifier);
        // b.setAttribute("class", "search-item");
          a.innerHTML = ` <a
                    href="/company/${arr[i].identifier}"><span>${highlightedText}</span></a>`;

          searchResultContainer.appendChild(a);
        }
        searchResult = arr || [];
        $("#searchText").trigger("focusin");
      }
    });
  }

        var currentRequest = null;

        adjust();
        $(window).resize(function(){
          adjust()
        });

        var gglide = new Glide('#intro', {
          type: 'carousel',
          perView: 1,
          peek: { before: 0, after: peekify() },
        })

        gglide.on("run", function(){
          var data = reference[gglide.index.toString()]
          $(".car-options").removeClass("buzz")
          $("#" + data).addClass("buzz")
          $("#append").html(loadingDiv)
          $("#pagination").html("")

          currentRequest = $.ajax({
            headers: { "X-CSRFToken": "{{csrf_token}}" },
            url: "{% url 'company_supplier' %}",
            type: "POST",
            data: {
              command: data,
              page:"1"
            },
            beforeSend : function()    {
              if(currentRequest != null) {
                currentRequest.abort();
              }
            },
            dataType: "json",
            success: function(jsonData) {
              if (jsonData.status == "empty"){
                $("#append").html(emptyDiv);
              }
              else{
                $("#append").html(jsonData.companies);
                $("#pagination").html(jsonData.pagination);
                favCheck();
              }
            },
            error: function(jsonData) {

            }
          });
        });
        gglide.mount()

        $("#append").html(loadingDiv)
        $("#pagination").html("")
        currentRequest = $.ajax({
          headers: { "X-CSRFToken": "{{csrf_token}}" },
          url: "{% url 'company_supplier' %}",
          type: "POST",
          data: {
            command: "saved",
            page:"1"
          },
          dataType: "json",
          success: function(jsonData) {
            if (jsonData.status == "empty"){
              $("#append").html(emptyDiv);
            }
            else{
              $("#append").html(jsonData.companies);
              $("#pagination").html(jsonData.pagination);
              favCheck();
            }
          },
          error: function(jsonData) {

          }
        });

        $(".tabs").each(function(){
          $(this).click(function(){
            $(".tabs").each(function(){
              $(this).removeClass("rounded-style-3 set-background buzz");
              $(this).css("color", "black")
            });
            $("#append").html(loadingDiv)
            $("#pagination").html("")
            $("#bigbox").removeClass("rounded-style-2");
            $(this).addClass("rounded-style-3 set-background");
            $(this).css("color", "white")
            $(this).addClass("buzz")
            if($(this).attr("id") == "saved") {
              $("#bigbox").addClass("rounded-style-2");
            }
            var data = $(this).attr("id");
            currentRequest = $.ajax({
              headers: { "X-CSRFToken": "{{csrf_token}}" },
              url: "{% url 'company_supplier' %}",
              type: "POST",
              data: {
                command: data,
                page:"1"
              },
              beforeSend : function()    {
                if(currentRequest != null) {
                  currentRequest.abort();
                }
              },
              dataType: "json",
              success: function(jsonData) {
                if (jsonData.status == "empty"){
                  $("#append").html(emptyDiv);
                }
                else{
                  $("#append").html(jsonData.companies);
                  $("#pagination").html(jsonData.pagination);
                  favCheck();
                }
              },
              error: function(jsonData) {

              }
            });
          });
        });
      });
function openNav() {
  document.getElementById("myNav").style.height = "100%";
  element = document.getElementsByTagName("body")[0];
  element.classList.add("noscroll");
}

function closeNav() {
  document.getElementById("myNav").style.height = "0%";
  element = document.getElementsByTagName("body")[0];
  element.classList.remove("noscroll");
}
function favCheck(){
  $(".fav").click(function(){
    var kl = parseInt($(this).attr("data-id"));
    var go = $(this).attr("data-selected");
    var p = this;

    if (go == "true"){
      $.ajax({
        headers: { "X-CSRFToken": "{{csrf_token}}" },
        url : "{% url 'remfav' %}",
        type : "POST",
        data : {
          id: kl
        },
        dataType: "json",
        success: function(response){
          if (response.status == "success"){
            $(p).attr("data-selected", "false");
            $(p).removeClass("yes");
            $(p).addClass("no");
          }
        }
      });
    }
    else{
      $.ajax({
        headers: { "X-CSRFToken": "{{csrf_token}}" },
        url : "{% url 'addfav' %}",
        type : "POST",
        data : {
          id: kl
        },
        dataType: "json",
        success: function(response){
          if (response.status == "success"){

            $(p).attr("data-selected", "true");
            $(p).removeClass("no");
            $(p).addClass("yes");
          }
        }
      });
    }
  });
}
</script>

{% endblock %}